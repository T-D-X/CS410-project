<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Candidate Semantic Search</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 24px; }
      textarea { width: 100%; min-height: 120px; }
      button { margin-top: 12px; padding: 8px 16px; }
      #results { margin-top: 24px; }
      .result-card { border: 1px solid #ccc; padding: 12px; margin-bottom: 10px; border-radius: 6px; }
      pre { background: #f5f5f5; padding: 10px; overflow: auto; }
    </style>
  </head>
  <body>
    <h1>Semantic Candidate Search</h1>
    <p>Describe the skills, experience, and education you need. The request will be sent to the server for semantic matching.</p>
    <form id="search-form">
      <label for="query">Search prompt</label><br />
      <textarea id="query" name="query" placeholder="e.g., 5+ years Python, Django, Postgres, experience with Celery"></textarea>
      <br />
      <label for="method">Search method</label><br />
      <select id="method" name="method">
        <option value="vector">Vector (cosine)</option>
        <option value="hybrid">Hybrid (vector + lexical)</option>
        <option value="bm25">BM25 (lexical)</option>
      </select>
      <br />
      <button type="submit">Search</button>
    </form>

    <h2>Results</h2>
    <div id="results"></div>

    <script>
      const form = document.getElementById("search-form");
      const resultsDiv = document.getElementById("results");

      function renderResults(payload) {
        if (payload.error) {
          resultsDiv.innerHTML = `<p style="color:red">${payload.error}</p>`;
          return;
        }
        const items = payload.results || [];
        if (!items.length) {
          resultsDiv.innerHTML = "<p>No matches found.</p>";
          return;
        }
        resultsDiv.innerHTML = items
          .map(
            (item) => `
              <div class="result-card">
                <strong>Candidate ${item.candidate_id} - ${item.file_name}</strong><br/>
                <small>Similarity: ${item.similarity !== null ? item.similarity.toFixed(3) : "n/a"}</small>
                <p>${item.content_preview}</p>
                <pre>${JSON.stringify(item.metadata || {}, null, 2)}</pre>
              </div>
            `
          )
          .join("");
      }

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        const query = document.getElementById("query").value;
        const method = document.getElementById("method").value;
        resultsDiv.innerHTML = "Searching...";
        try {
          const response = await fetch(window.location.pathname, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ query, method })
          });
          const data = await response.json();
          renderResults(data);
        } catch (err) {
          resultsDiv.innerHTML = `<p style="color:red">Request failed: ${err}</p>`;
        }
      });
    </script>
  </body>
</html>
